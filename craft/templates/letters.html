{% extends "_common/layout" %}

{% set title = "Letters" %}

{% block main %}
  {% embed "_common/list" %}
    {% block subNav %}
    {% endblock %}

    {% block h2 %}
      Letters to the Editor
    {% endblock %}
    
    {% block posts %}
      {% set entries = craft.entries.section('letters').find %}

      <div id="letters-by-date">
        {% for groupedDate, groupedEntries in entries | group("postDate") %}
          <h2 class="date-divider">{{ groupedDate | date('F j, Y') }} <span class="comment-count disqus-comment-count" data-disqus-identifier="{{ groupedDate | date('F j, Y') }}"></span></h2>
          <div>
            {% for entry in groupedEntries %}
              <h3>{{ entry.title }}</h3>
              {{ p.authorLink(entry) }} &mdash; {{ entry.author.city }} {{- p.editLink(entry) -}}<br>
              {{ entry.postDate | date('g:i A') }} <br>
              <p>{{ entry.letterContent }}</p>
            {% endfor %}

            <h3>Join the Conversation</h3>
            {% set mdyDate = groupedDate | date('F j, Y') %}
            {% set ymdDate = groupedDate | date('Y/m/d') %}
            <button class="toggle-comments-for-date" data-mdy-date="{{ mdyDate }}" data-ymd-date="{{ ymdDate }}">View Comments</button>
            {% if loop.first %}
              <div id="wrap-comments-for-date" style="display: none;">
                {% include "_common/disqus_letters.html" with { 'mdyDate': mdyDate, 'ymdDate': ymdDate } only %}
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endblock %}
  {% endembed %}
{% endblock %}

{% set js %}
$(function() {
  $("#letters-by-date").accordion({
    'header': 'h2'
  });
});
{% endset %}

{% includeJs js %}
