{% extends "_common/layout" %}

{% set title = "Letters" %}

{% block main %}
  {% embed "_common/list" %}
    {% block subNav %}
      <h4>Archive</h4>
      <div id="select-letter-date"></div>
    {% endblock %}

    {% block h2 %}
      Letters
    {% endblock %}
    
    {% block posts %}
      {% if craft.request.segments | length > 1 %}
        {% set year = craft.request.segment(2) %}
        {% set month = craft.request.segment(3) %}
        {% set day = craft.request.segment(4) %}
        {% set ymd = year~'-'~month~'-'~day %}
      {% else %}
        {% set ymd = date() | date('Y-m-d') %}
      {% endif %}
      {% set nextYmd = ymd | date_modify('+1 day') | date('Y-m-d') %}
      {% set entries = craft.entries.section('letters').after(ymd).before(nextYmd).find %}

      <div>
        <h2>{{ date(ymd) | date('F j, Y') }}</h2>

        {% if entries %}
          {% for entry in entries | sort %}
            <h3>{{ entry.title }}</h3>
            {{ p.authorLink(entry) }} &mdash; {{ entry.author.city }} {{- p.editLink(entry) -}} {{ entry.postDate | date('g:i A') }}<br>
            <p>{{ entry.letterContent }}</p>
          {% endfor %}

          <h3>Join the Conversation</h3>
          <button id="toggle-letter-comments">Show Comments</button>
          <div id="letter-comments" style="display: none;">
            {% set disqusId = ymd %}
            {% set disqusTitle = date(ymd) | date('F j, Y') %}
            {% set disqusUrl = siteUrl ~ '/letters/' ~ ymd | replace('-', '/') %}
            {% include "_common/disqus_embed.html" with { identifier: disqusId, title: disqusTitle, url: disqusUrl } only %}
          </div>

        {% else %}
          No letters found

        {% endif %}
      </div>
    {% endblock %}
  {% endembed %}
{% endblock %}

{% set css %}
#select-letter-date {
  font-size: .75em;
}
{% endset %}
{% includeCss css %}
