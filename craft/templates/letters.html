{% extends "_common/layout" %}

{% set title = "Letters" %}

{% block main %}
  {% embed "_common/list" %}
    {% block subNav %}
      <ul>
      {% for i in [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13 ] %}
        {% set day = date('-'~i~'days') %}
        {% set url = '/letters/' ~ day | date('Y/m/d') %}
        <li {{ n.activeLetterDate(url, loop.first) }}>
          <a href="{{ url }}">{{ day | date('F j, Y') }}</a>
        </li>
      {% endfor %}
      </ul>
      <h4>Archive</h4>
      {{ craft.request.path }}
      <input type="date" id="select-date">
    {% endblock %}

    {% block h2 %}
      Letters
    {% endblock %}
    
    {% block posts %}
      {% if craft.request.segments | length > 1 %}
        {% set year = craft.request.segment(2) %}
        {% set month = craft.request.segment(3) %}
        {% set day = craft.request.segment(4) %}
        {% set ymd = year~'-'~month~'-'~day %}
      {% else %}
        {% set ymd = date() | date('Y-m-d') %}
      {% endif %}
      {% set nextYmd = ymd | date_modify('+1 day') | date('Y-m-d') %}
      {% set entries = craft.entries.section('letters').after(ymd).before(nextYmd).find %}

      <div>
        <h2>{{ date(ymd) | date('F j, Y') }}</h2>

        {% if entries %}
          {% for entry in entries | sort %}
            <h3>{{ entry.title }}</h3>
            {{ p.authorLink(entry) }} &mdash; {{ entry.author.city }} {{- p.editLink(entry) -}} {{ entry.postDate | date('g:i A') }}<br>
            <p>{{ entry.letterContent }}</p>
          {% endfor %}

          <h3>Join the Conversation</h3>
          <button id="toggle-comments">Show Comments</button>
          <div id="comments" style="display: none;">
            {% set disqusId = ymd %}
            {% set disqusTitle = date(ymd) | date('F j, Y') %}
            {% set disqusUrl = siteUrl ~ '/letters/' ~ ymd | replace('-', '/') %}
            {% include "_common/disqus_embed.html" with { identifier: disqusId, title: disqusTitle, url: disqusUrl } only %}
          </div>

        {% else %}
          No letters found

        {% endif %}
      </div>
    {% endblock %}
  {% endembed %}
{% endblock %}

{% set js %}
$(function() {
  var selectDate = $('#select-date');
  var toggleComments = $('#toggle-comments');
  var comments = $('#comments');

  selectDate.change(function() {
    var ymd = this.value.replace(/-/g, '/');

    if (ymd.length > 0) {
      document.location = '/letters/'+ymd;
    }
  });

  toggleComments.click(function() {
    comments.toggle();
    toggleComments.text((comments.is(':visible') ? 'Hide' : 'Show') + ' Comments');
  });
});
{% endset %}

{% includeJs js %}
