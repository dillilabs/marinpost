{% extends "_common/layout" %}

{% set default = siteDefaults.siteDefault.key('entriesPerPage').first %}
{% set entriesPerPage = default ? default.value : 10 %}

{% set limit = entriesPerPage + 1 %} {# +1 featured entry #}
{% set entries = craft.entries.section('blog', 'media', 'news', 'notices').limit(limit).find %}
{% set featured = entries | first %}

{% set letters = craft.entries.section('letters').limit(entriesPerPage) %}

{% block main %}
  {% embed "_common/home" %}
    {% block featured %}
      {% if featured %}
        {{ p.featuredPost(featured) }}
      {% endif %}
    {% endblock %}

    {% block whatsNew %}
      <h2>What's New</h2>

      <ul class="posts">
      {% for entry in entries | without(featured) %}
        {{ p.post(entry, true) }}
      {% endfor %}
      </ul>

      <aside>
        <h2>Letters</h2>
        <div id="comments">
          <ul>
          {% for letter in letters %}
            <li>
              <h4><a href="/letters/{{ letter.postDate | date('Y/m/d') }}">{{ p.titleCase(letter.title) }}</a></h4>
              <p>{{ letter.letterContent | slice(0, 180) }} &hellip;</p>
              {{ p.authorNameOrLink(letter, 'user') }}
            </li>
          {% endfor %}
          </ul>
        </div>
      </aside>
    {% endblock %}
  {% endembed %}
{% endblock %}

{% set js %}
  $(function() {
    $('ul.posts').scrollingContent();
  });
{% endset %}

{% includeJs js %}
