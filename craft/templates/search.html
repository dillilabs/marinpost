{% set query = craft.request.param('query') | replace('/^\\s+$/', '') %}

{% if query | length %}
  {% set searchTerms = query | split(' ') | filter | join(' OR ') %}
  {% set entries = craft.entries.search(searchTerms).order('score') %}

  {% set section = craft.request.param('section') %}
  {% set entries = section ? entries.section(section) : entries %}
{% endif %}

{% extends "_common/layout" %}

{% set title = "Search" %}

{% block main %}
  {% embed "_common/single" %}
    {% block subNav %}
    {% endblock %}

    {% block typeOfWrapper %}list-wrapper{% endblock %}
    {% block title %}Search Results{% endblock %}
    {% block post %}
      {% if query | length %}
        {% if entries | length %}
          <ul class="posts">
          {% for entry in entries %}
            {{ p.post(entry, true) }}
          {% endfor %}
          </ul>
        {% else %}
          <p>Can't find no stinkin' <i>{{ query }}</i>{%- if section %} in {{ section }}{% endif -%}</p>
        {% endif %}
      {% else %}
        {% include "_common/search" %}
      {% endif %}
    {% endblock %}
  {% endembed %}
{% endblock %}
